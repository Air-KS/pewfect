{"ast":null,"code":"// ./frontend/src/store/index.js\n\nimport { createStore } from 'vuex';\nfunction getUserFromLocalStorage() {\n  try {\n    const user = localStorage.getItem('user');\n    console.log('User in localStorage:', user);\n    if (user && user !== 'undefined') {\n      // Vérifie que user n'est pas null ou undefined\n      return JSON.parse(user);\n    }\n    return null;\n  } catch (error) {\n    console.error('Error parsing user data from localStorage', error);\n    return null;\n  }\n}\nconst store = createStore({\n  state: {\n    isLoggedIn: !!localStorage.getItem('token'),\n    user: getUserFromLocalStorage()\n  },\n  mutations: {\n    setLoginState(state, payload) {\n      state.isLoggedIn = payload.isLoggedIn;\n      state.user = payload.user;\n    },\n    logout(state) {\n      state.isLoggedIn = false;\n      state.user = null;\n      localStorage.removeItem('user');\n      localStorage.removeItem('token');\n      localStorage.removeItem('role');\n    }\n  },\n  actions: {\n    login({\n      commit\n    }, {\n      user,\n      token,\n      role\n    }) {\n      localStorage.setItem('user', JSON.stringify(user));\n      localStorage.setItem('token', token);\n      localStorage.setItem('role', role);\n      commit('setLoginState', {\n        isLoggedIn: true,\n        user: {\n          ...user,\n          token,\n          role\n        }\n      });\n    },\n    logout({\n      commit\n    }) {\n      commit('logout');\n    },\n    checkLoginState({\n      commit\n    }) {\n      const token = localStorage.getItem('token');\n      const user = getUserFromLocalStorage();\n      const role = localStorage.getItem('role');\n\n      // Ajout des instructions de débogage\n      console.log('Token:', token);\n      console.log('User:', user);\n      console.log('Role:', role);\n      if (token && user) {\n        commit('setLoginState', {\n          isLoggedIn: true,\n          user: {\n            ...user,\n            token,\n            role\n          }\n        });\n      } else {\n        commit('logout');\n      }\n    }\n  }\n});\nexport default store;","map":{"version":3,"names":["createStore","getUserFromLocalStorage","user","localStorage","getItem","console","log","JSON","parse","error","store","state","isLoggedIn","mutations","setLoginState","payload","logout","removeItem","actions","login","commit","token","role","setItem","stringify","checkLoginState"],"sources":["/home/zana/pewfect-1/frontend/src/store/index.js"],"sourcesContent":["// ./frontend/src/store/index.js\n\nimport { createStore } from 'vuex';\n\nfunction getUserFromLocalStorage() {\n  try {\n    const user = localStorage.getItem('user');\n    console.log('User in localStorage:', user);\n    if (user && user !== 'undefined') { // Vérifie que user n'est pas null ou undefined\n      return JSON.parse(user);\n    }\n    return null;\n  } catch (error) {\n    console.error('Error parsing user data from localStorage', error);\n    return null;\n  }\n}\n\nconst store = createStore({\n  state: {\n    isLoggedIn: !!localStorage.getItem('token'),\n    user: getUserFromLocalStorage(),\n  },\n  mutations: {\n    setLoginState(state, payload) {\n      state.isLoggedIn = payload.isLoggedIn;\n      state.user = payload.user;\n    },\n    logout(state) {\n      state.isLoggedIn = false;\n      state.user = null;\n      localStorage.removeItem('user');\n      localStorage.removeItem('token');\n      localStorage.removeItem('role');\n    },\n  },\n  actions: {\n    login({ commit }, { user, token, role }) {\n      localStorage.setItem('user', JSON.stringify(user));\n      localStorage.setItem('token', token);\n      localStorage.setItem('role', role);\n      commit('setLoginState', { isLoggedIn: true, user: { ...user, token, role } });\n    },\n    logout({ commit }) {\n      commit('logout');\n    },\n    checkLoginState({ commit }) {\n      const token = localStorage.getItem('token');\n      const user = getUserFromLocalStorage();\n      const role = localStorage.getItem('role');\n\n      // Ajout des instructions de débogage\n      console.log('Token:', token);\n      console.log('User:', user);\n      console.log('Role:', role);\n\n      if (token && user) {\n        commit('setLoginState', { isLoggedIn: true, user: { ...user, token, role } });\n      } else {\n        commit('logout');\n      }\n    },\n  },\n});\n\nexport default store;\n"],"mappings":"AAAA;;AAEA,SAASA,WAAW,QAAQ,MAAM;AAElC,SAASC,uBAAuBA,CAAA,EAAG;EACjC,IAAI;IACF,MAAMC,IAAI,GAAGC,YAAY,CAACC,OAAO,CAAC,MAAM,CAAC;IACzCC,OAAO,CAACC,GAAG,CAAC,uBAAuB,EAAEJ,IAAI,CAAC;IAC1C,IAAIA,IAAI,IAAIA,IAAI,KAAK,WAAW,EAAE;MAAE;MAClC,OAAOK,IAAI,CAACC,KAAK,CAACN,IAAI,CAAC;IACzB;IACA,OAAO,IAAI;EACb,CAAC,CAAC,OAAOO,KAAK,EAAE;IACdJ,OAAO,CAACI,KAAK,CAAC,2CAA2C,EAAEA,KAAK,CAAC;IACjE,OAAO,IAAI;EACb;AACF;AAEA,MAAMC,KAAK,GAAGV,WAAW,CAAC;EACxBW,KAAK,EAAE;IACLC,UAAU,EAAE,CAAC,CAACT,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC;IAC3CF,IAAI,EAAED,uBAAuB,CAAC;EAChC,CAAC;EACDY,SAAS,EAAE;IACTC,aAAaA,CAACH,KAAK,EAAEI,OAAO,EAAE;MAC5BJ,KAAK,CAACC,UAAU,GAAGG,OAAO,CAACH,UAAU;MACrCD,KAAK,CAACT,IAAI,GAAGa,OAAO,CAACb,IAAI;IAC3B,CAAC;IACDc,MAAMA,CAACL,KAAK,EAAE;MACZA,KAAK,CAACC,UAAU,GAAG,KAAK;MACxBD,KAAK,CAACT,IAAI,GAAG,IAAI;MACjBC,YAAY,CAACc,UAAU,CAAC,MAAM,CAAC;MAC/Bd,YAAY,CAACc,UAAU,CAAC,OAAO,CAAC;MAChCd,YAAY,CAACc,UAAU,CAAC,MAAM,CAAC;IACjC;EACF,CAAC;EACDC,OAAO,EAAE;IACPC,KAAKA,CAAC;MAAEC;IAAO,CAAC,EAAE;MAAElB,IAAI;MAAEmB,KAAK;MAAEC;IAAK,CAAC,EAAE;MACvCnB,YAAY,CAACoB,OAAO,CAAC,MAAM,EAAEhB,IAAI,CAACiB,SAAS,CAACtB,IAAI,CAAC,CAAC;MAClDC,YAAY,CAACoB,OAAO,CAAC,OAAO,EAAEF,KAAK,CAAC;MACpClB,YAAY,CAACoB,OAAO,CAAC,MAAM,EAAED,IAAI,CAAC;MAClCF,MAAM,CAAC,eAAe,EAAE;QAAER,UAAU,EAAE,IAAI;QAAEV,IAAI,EAAE;UAAE,GAAGA,IAAI;UAAEmB,KAAK;UAAEC;QAAK;MAAE,CAAC,CAAC;IAC/E,CAAC;IACDN,MAAMA,CAAC;MAAEI;IAAO,CAAC,EAAE;MACjBA,MAAM,CAAC,QAAQ,CAAC;IAClB,CAAC;IACDK,eAAeA,CAAC;MAAEL;IAAO,CAAC,EAAE;MAC1B,MAAMC,KAAK,GAAGlB,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC;MAC3C,MAAMF,IAAI,GAAGD,uBAAuB,CAAC,CAAC;MACtC,MAAMqB,IAAI,GAAGnB,YAAY,CAACC,OAAO,CAAC,MAAM,CAAC;;MAEzC;MACAC,OAAO,CAACC,GAAG,CAAC,QAAQ,EAAEe,KAAK,CAAC;MAC5BhB,OAAO,CAACC,GAAG,CAAC,OAAO,EAAEJ,IAAI,CAAC;MAC1BG,OAAO,CAACC,GAAG,CAAC,OAAO,EAAEgB,IAAI,CAAC;MAE1B,IAAID,KAAK,IAAInB,IAAI,EAAE;QACjBkB,MAAM,CAAC,eAAe,EAAE;UAAER,UAAU,EAAE,IAAI;UAAEV,IAAI,EAAE;YAAE,GAAGA,IAAI;YAAEmB,KAAK;YAAEC;UAAK;QAAE,CAAC,CAAC;MAC/E,CAAC,MAAM;QACLF,MAAM,CAAC,QAAQ,CAAC;MAClB;IACF;EACF;AACF,CAAC,CAAC;AAEF,eAAeV,KAAK","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}