{"ast":null,"code":"import axios from 'axios';\nimport UserTable from '../components/userTable.vue';\nimport researchBar from '../components/researchBar.vue';\nexport default {\n  name: 'AdminPage',\n  components: {\n    UserTable,\n    researchBar\n  },\n  data() {\n    return {\n      users: [],\n      // Liste des utilisateurs\n      userRole: '',\n      // Rôle de l'utilisateur connecté\n      searchQuery: '' // Requête de recherche\n    };\n  },\n  // Récupère les utilisateurs et initialise le rôle\n  async mounted() {\n    await this.refreshUsers();\n    this.userRole = localStorage.getItem('role');\n  },\n  computed: {\n    // Filtre les utilisateurs par rôle\n    filteredUsers() {\n      return role => {\n        return this.filterUsers(this.filterUsersByRole(role));\n      };\n    }\n  },\n  methods: {\n    // Méthode pour changer le rôle d'un utilisateur\n    async changeUserRole(userId, newRole) {\n      try {\n        await axios.put(`http://localhost:3000/api/users/${userId}/role`, {\n          role: newRole\n        });\n        alert(`Utilisateur mis à jour avec succès vers ${newRole}`);\n        this.refreshUsers();\n      } catch (error) {\n        console.error(`Erreur lors de la mise à jour de l'utilisateur :`, error);\n      }\n    },\n    // Méthode pour supprimer un utilisateur\n    async deleteUser(userId) {\n      try {\n        await axios.delete(`http://localhost:3000/api/users/${userId}`);\n        alert('Utilisateur supprimé avec succès');\n        this.refreshUsers();\n      } catch (error) {\n        console.error(\"Erreur lors de la suppression de l'utilisateur :\", error);\n      }\n    },\n    // Méthode pour récupérer et initialiser les utilisateurs\n    async refreshUsers() {\n      try {\n        const response = await axios.get('http://localhost:3000/api/users');\n        this.users = response.data;\n      } catch (error) {\n        console.error('Erreur lors de la récupération des utilisateurs :', error);\n      }\n    },\n    // Méthode pour filtrer les utilisateurs par rôle\n    filterUsersByRole(role) {\n      return this.users.filter(user => user.Register && user.Register.Role && user.Register.Role.role === role);\n    },\n    // Méthode pour filtrer les utilisateurs par requête de recherche\n    filterUsers(users) {\n      return users.filter(user => {\n        const fullName = `${user.last_name} ${user.first_name} ${user.email} ${user.phone}`.toLowerCase();\n        return fullName.includes(this.searchQuery.toLowerCase());\n      });\n    }\n  }\n};","map":{"version":3,"names":["axios","UserTable","researchBar","name","components","data","users","userRole","searchQuery","mounted","refreshUsers","localStorage","getItem","computed","filteredUsers","role","filterUsers","filterUsersByRole","methods","changeUserRole","userId","newRole","put","alert","error","console","deleteUser","delete","response","get","filter","user","Register","Role","fullName","last_name","first_name","email","phone","toLowerCase","includes"],"sources":["/home/zana/pewfect-1/frontend/src/views/adminPage.vue"],"sourcesContent":["<!--\n\t./frontend/src/views/adminPage.vue\n-->\n\n<template>\n\t<div class=\"admin-container\">\n\t\t<h1>Admin Page</h1>\n\n\t\t<!-- Bar de Recherche -->\n\t\t<researchBar v-model=\"searchQuery\" placeholder=\"Search for a user...\" />\n\n\t\t<!-- Table des utilisateurs avec le rôle \"admin\" -->\n\t\t<UserTable\n\t\t\ttitle=\"Admins\"\n\t\t\t:users=\"filteredUsers('admin')\"\n\t\t\trole=\"admin\"\n\t\t\t:userRole=\"userRole\"\n\t\t\t@change-role=\"changeUserRole\"\n\t\t\t@delete-user=\"deleteUser\"\n\t\t/>\n\t\t<!-- Table des utilisateurs avec le rôle \"responsable\" -->\n\t\t<UserTable\n\t\t\ttitle=\"Responsables\"\n\t\t\t:users=\"filteredUsers('responsable')\"\n\t\t\trole=\"responsable\"\n\t\t\t:userRole=\"userRole\"\n\t\t\t@change-role=\"changeUserRole\"\n\t\t\t@delete-user=\"deleteUser\"\n\t\t/>\n\t\t<!-- Table des utilisateurs avec le rôle \"client\" -->\n\t\t<UserTable\n\t\t\ttitle=\"Clients\"\n\t\t\t:users=\"filteredUsers('client')\"\n\t\t\trole=\"client\"\n\t\t\t:userRole=\"userRole\"\n\t\t\t@change-role=\"changeUserRole\"\n\t\t\t@delete-user=\"deleteUser\"\n\t\t/>\n\t</div>\n</template>\n\n<script>\nimport axios from 'axios';\nimport UserTable from '../components/userTable.vue';\nimport researchBar from '../components/researchBar.vue';\n\nexport default {\n\tname: 'AdminPage',\n\tcomponents: {\n\t\tUserTable,\n\t\tresearchBar,\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tusers: [], // Liste des utilisateurs\n\t\t\tuserRole: '', // Rôle de l'utilisateur connecté\n\t\t\tsearchQuery: '', // Requête de recherche\n\t\t};\n\t},\n\t// Récupère les utilisateurs et initialise le rôle\n\tasync mounted() {\n\t\tawait this.refreshUsers();\n\t\tthis.userRole = localStorage.getItem('role');\n\t},\n\tcomputed: {\n\t\t// Filtre les utilisateurs par rôle\n\t\tfilteredUsers() {\n\t\t\treturn role => {\n\t\t\t\treturn this.filterUsers(this.filterUsersByRole(role));\n\t\t\t};\n\t\t},\n\t},\n\n\tmethods: {\n\t\t// Méthode pour changer le rôle d'un utilisateur\n\t\tasync changeUserRole(userId, newRole) {\n\t\t\ttry {\n\t\t\t\tawait axios.put(`http://localhost:3000/api/users/${userId}/role`, {\n\t\t\t\t\trole: newRole,\n\t\t\t\t});\n\t\t\t\talert(`Utilisateur mis à jour avec succès vers ${newRole}`);\n\t\t\t\tthis.refreshUsers();\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error(\n\t\t\t\t\t`Erreur lors de la mise à jour de l'utilisateur :`,\n\t\t\t\t\terror\n\t\t\t\t);\n\t\t\t}\n\t\t},\n\n\t\t// Méthode pour supprimer un utilisateur\n\t\tasync deleteUser(userId) {\n\t\t\ttry {\n\t\t\t\tawait axios.delete(`http://localhost:3000/api/users/${userId}`);\n\t\t\t\talert('Utilisateur supprimé avec succès');\n\t\t\t\tthis.refreshUsers();\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error(\n\t\t\t\t\t\"Erreur lors de la suppression de l'utilisateur :\",\n\t\t\t\t\terror\n\t\t\t\t);\n\t\t\t}\n\t\t},\n\n\t\t// Méthode pour récupérer et initialiser les utilisateurs\n\t\tasync refreshUsers() {\n\t\t\ttry {\n\t\t\t\tconst response = await axios.get('http://localhost:3000/api/users');\n\t\t\t\tthis.users = response.data;\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error(\n\t\t\t\t\t'Erreur lors de la récupération des utilisateurs :',\n\t\t\t\t\terror\n\t\t\t\t);\n\t\t\t}\n\t\t},\n\n\t\t// Méthode pour filtrer les utilisateurs par rôle\n\t\tfilterUsersByRole(role) {\n\t\t\treturn this.users.filter(\n\t\t\t\tuser =>\n\t\t\t\t\tuser.Register &&\n\t\t\t\t\tuser.Register.Role &&\n\t\t\t\t\tuser.Register.Role.role === role\n\t\t\t);\n\t\t},\n\n\t\t// Méthode pour filtrer les utilisateurs par requête de recherche\n\t\tfilterUsers(users) {\n\t\t\treturn users.filter(user => {\n\t\t\t\tconst fullName =\n\t\t\t\t\t`${user.last_name} ${user.first_name} ${user.email} ${user.phone}`.toLowerCase();\n\t\t\t\treturn fullName.includes(this.searchQuery.toLowerCase());\n\t\t\t});\n\t\t},\n\t},\n};\n</script>\n\n<style scoped>\n/* Styles pour le conteneur admin */\n.admin-container {\n\tdisplay: flex;\n\tflex-direction: column;\n\talign-items: center;\n\tjustify-content: center;\n\tpadding: 20px;\n}\n</style>\n"],"mappings":"AA0CA,OAAOA,KAAI,MAAO,OAAO;AACzB,OAAOC,SAAQ,MAAO,6BAA6B;AACnD,OAAOC,WAAU,MAAO,+BAA+B;AAEvD,eAAe;EACdC,IAAI,EAAE,WAAW;EACjBC,UAAU,EAAE;IACXH,SAAS;IACTC;EACD,CAAC;EACDG,IAAIA,CAAA,EAAG;IACN,OAAO;MACNC,KAAK,EAAE,EAAE;MAAE;MACXC,QAAQ,EAAE,EAAE;MAAE;MACdC,WAAW,EAAE,EAAE,CAAE;IAClB,CAAC;EACF,CAAC;EACD;EACA,MAAMC,OAAOA,CAAA,EAAG;IACf,MAAM,IAAI,CAACC,YAAY,CAAC,CAAC;IACzB,IAAI,CAACH,QAAO,GAAII,YAAY,CAACC,OAAO,CAAC,MAAM,CAAC;EAC7C,CAAC;EACDC,QAAQ,EAAE;IACT;IACAC,aAAaA,CAAA,EAAG;MACf,OAAOC,IAAG,IAAK;QACd,OAAO,IAAI,CAACC,WAAW,CAAC,IAAI,CAACC,iBAAiB,CAACF,IAAI,CAAC,CAAC;MACtD,CAAC;IACF;EACD,CAAC;EAEDG,OAAO,EAAE;IACR;IACA,MAAMC,cAAcA,CAACC,MAAM,EAAEC,OAAO,EAAE;MACrC,IAAI;QACH,MAAMrB,KAAK,CAACsB,GAAG,CAAC,mCAAmCF,MAAM,OAAO,EAAE;UACjEL,IAAI,EAAEM;QACP,CAAC,CAAC;QACFE,KAAK,CAAC,2CAA2CF,OAAO,EAAE,CAAC;QAC3D,IAAI,CAACX,YAAY,CAAC,CAAC;MACpB,EAAE,OAAOc,KAAK,EAAE;QACfC,OAAO,CAACD,KAAK,CACZ,kDAAkD,EAClDA,KACD,CAAC;MACF;IACD,CAAC;IAED;IACA,MAAME,UAAUA,CAACN,MAAM,EAAE;MACxB,IAAI;QACH,MAAMpB,KAAK,CAAC2B,MAAM,CAAC,mCAAmCP,MAAM,EAAE,CAAC;QAC/DG,KAAK,CAAC,kCAAkC,CAAC;QACzC,IAAI,CAACb,YAAY,CAAC,CAAC;MACpB,EAAE,OAAOc,KAAK,EAAE;QACfC,OAAO,CAACD,KAAK,CACZ,kDAAkD,EAClDA,KACD,CAAC;MACF;IACD,CAAC;IAED;IACA,MAAMd,YAAYA,CAAA,EAAG;MACpB,IAAI;QACH,MAAMkB,QAAO,GAAI,MAAM5B,KAAK,CAAC6B,GAAG,CAAC,iCAAiC,CAAC;QACnE,IAAI,CAACvB,KAAI,GAAIsB,QAAQ,CAACvB,IAAI;MAC3B,EAAE,OAAOmB,KAAK,EAAE;QACfC,OAAO,CAACD,KAAK,CACZ,mDAAmD,EACnDA,KACD,CAAC;MACF;IACD,CAAC;IAED;IACAP,iBAAiBA,CAACF,IAAI,EAAE;MACvB,OAAO,IAAI,CAACT,KAAK,CAACwB,MAAM,CACvBC,IAAG,IACFA,IAAI,CAACC,QAAO,IACZD,IAAI,CAACC,QAAQ,CAACC,IAAG,IACjBF,IAAI,CAACC,QAAQ,CAACC,IAAI,CAAClB,IAAG,KAAMA,IAC9B,CAAC;IACF,CAAC;IAED;IACAC,WAAWA,CAACV,KAAK,EAAE;MAClB,OAAOA,KAAK,CAACwB,MAAM,CAACC,IAAG,IAAK;QAC3B,MAAMG,QAAO,GACZ,GAAGH,IAAI,CAACI,SAAS,IAAIJ,IAAI,CAACK,UAAU,IAAIL,IAAI,CAACM,KAAK,IAAIN,IAAI,CAACO,KAAK,EAAE,CAACC,WAAW,CAAC,CAAC;QACjF,OAAOL,QAAQ,CAACM,QAAQ,CAAC,IAAI,CAAChC,WAAW,CAAC+B,WAAW,CAAC,CAAC,CAAC;MACzD,CAAC,CAAC;IACH;EACD;AACD,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}